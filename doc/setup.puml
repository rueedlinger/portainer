@startuml
title Local Network 192.168.1.0/24
left to right direction

' -----------------------
' Styling
' -----------------------
skinparam component {
  BackgroundColor<<container>> #FFF9C4
  BorderColor #BDB76B
  FontColor #000000

  BackgroundColor<<exposed>> #FFEBEE
  BorderColor<<exposed>> #C62828
  FontColor<<exposed>> #000000

  BackgroundColor<<internal>> #BBDEFB
  BorderColor<<internal>> #1E88E5
  FontColor<<internal>> #000000
}

' -----------------------
' External user
' -----------------------
actor "User" as User

' -----------------------
' Router and Internet (left side)
' -----------------------
node "Router\n192.168.1.1\n(Gateway, DNS, DHCP)" as Router
cloud "Internet" as Internet

' -----------------------
' Host Layer
' -----------------------
node "Proxmox VE Host\nManagement Interface: 192.168.1.50" <<host>> as Proxmox {

    ' -----------------------
    ' VM Layer
    ' -----------------------
    node "VM Lab\nGuest OS / Services\nIP: 192.168.1.51" <<virtual machine>> as VM {

        ' -----------------------
        ' Docker Network Layer
        ' -----------------------
        node "Docker Network\n172.19.0.0/16" <<docker>> as DockerNet {

            component "portainer.svc" <<container>> as Portainer {
                  [HTTPS:9443]  <<exposed>> as portainer_https_exposed
                  [HTTPS:9443]  <<internal>> as portainer_https_internal
                  [HTTP:9000]  <<internal>> as portainer_http_internal
            }
            
            component "dns-proxy.svc" <<container>> as DNSProxy {
                [DNS_TCP:53]    <<internal>> as dns_tcp_internal
                [DNS_UDP:53]    <<internal>> as dns_udp_internal
                [Web:5380]      <<internal>> as dns_web_internal
                [DNS_TCP:5453]  <<exposed>> as dns_tcp_exposed
                [DNS_UDP:5453] <<exposed>> as dns_udp_exposed
            }

            component "reverse-proxy.svc" <<container>> as ReverseProxy {
                [HTTP:80]   <<internal>> as proxy_http_internal
                [HTTPS:443] <<internal>> as proxy_https_internal
                [Admin:81]  <<internal>> as proxy_admin_internal
                [HTTP:80]   <<exposed>> as proxy_http_exposed
                [HTTPS:443] <<exposed>> as proxy_https_exposed
                [Admin:81]  <<exposed>> as proxy_admin_exposed
                
            }

            component "uptime-kuma.svc" <<container>> as UptimeKuma {
                [Web:3001] <<internal>> as kuma_web_internal
            }
        }
    }
}

' -----------------------
' Network Connections
' -----------------------
DockerNet <--> VM
VM <--> Proxmox
Proxmox <--> Router : vmbr0
Router <--> Internet

' External user access
User --> proxy_http_exposed
User --> proxy_https_exposed
User --> proxy_admin_exposed
User --> portainer_https_exposed
User --> dns_udp_exposed
User --> dns_tcp_exposed

portainer_https_exposed --> portainer_https_internal

proxy_http_exposed --> proxy_http_internal
proxy_https_exposed --> proxy_https_internal
proxy_admin_exposed --> proxy_admin_internal

proxy_https_internal-->  kuma_web_internal : kuma-uptime.local
proxy_https_internal -->  dns_web_internal : dns-admin.local

' Artifact dependencies: exposed DNS â†’ internal DNS
dns_udp_exposed-> dns_udp_internal
dns_tcp_exposed-> dns_tcp_internal

@enduml
